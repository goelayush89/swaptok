{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _defineProperty from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _asyncToGenerator from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useEffect, useState } from 'react';\nimport { utils } from 'ethers';\nimport { getChainById } from '../helpers';\nimport { useEthers, useBlockNumber, useConfig, useUpdateConfig, useLocalStorage } from '../hooks';\nimport multicallABI from '../constants/abi/MultiCall.json';\nimport multicall2ABI from '../constants/abi/MultiCall2.json';\nimport { deployContract } from '../helpers/contract';\nvar LocalMulticallState;\n\n(function (LocalMulticallState) {\n  LocalMulticallState[LocalMulticallState[\"Unknown\"] = 0] = \"Unknown\";\n  LocalMulticallState[LocalMulticallState[\"NonLocal\"] = 1] = \"NonLocal\";\n  LocalMulticallState[LocalMulticallState[\"Deploying\"] = 2] = \"Deploying\";\n  LocalMulticallState[LocalMulticallState[\"Deployed\"] = 3] = \"Deployed\";\n  LocalMulticallState[LocalMulticallState[\"Error\"] = 4] = \"Error\";\n})(LocalMulticallState || (LocalMulticallState = {}));\n\nexport function LocalMulticallProvider(_ref) {\n  var children = _ref.children;\n  var updateConfig = useUpdateConfig();\n\n  var _useEthers = useEthers(),\n      library = _useEthers.library,\n      chainId = _useEthers.chainId;\n\n  var _useLocalStorage = useLocalStorage('local_multicall_address' + chainId),\n      _useLocalStorage2 = _slicedToArray(_useLocalStorage, 3),\n      setMulticallAddress = _useLocalStorage2[1],\n      getCurrent = _useLocalStorage2[2];\n\n  var _useConfig = useConfig(),\n      multicallAddresses = _useConfig.multicallAddresses,\n      multicallVersion = _useConfig.multicallVersion;\n\n  var _useState = useState(LocalMulticallState.Unknown),\n      _useState2 = _slicedToArray(_useState, 2),\n      localMulticallState = _useState2[0],\n      setLocalMulticallState = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      multicallBlockNumber = _useState4[0],\n      setMulticallBlockNumber = _useState4[1];\n\n  var blockNumber = useBlockNumber();\n  useEffect(function () {\n    var _a;\n\n    if (!library || !chainId) {\n      setLocalMulticallState(LocalMulticallState.Unknown);\n    } else if (!((_a = getChainById(chainId)) === null || _a === void 0 ? void 0 : _a.isLocalChain)) {\n      setLocalMulticallState(LocalMulticallState.NonLocal);\n    } else if (multicallAddresses && multicallAddresses[chainId]) {\n      setLocalMulticallState(LocalMulticallState.Deployed);\n    } else if (localMulticallState !== LocalMulticallState.Deploying) {\n      var checkDeployed = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n          var multicallAddress, multicallCode, signer, deployMulticall;\n          return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  multicallAddress = getCurrent();\n\n                  if (!(typeof multicallAddress === 'string' && utils.isAddress(multicallAddress))) {\n                    _context2.next = 8;\n                    break;\n                  }\n\n                  _context2.next = 4;\n                  return library.getCode(multicallAddress);\n\n                case 4:\n                  multicallCode = _context2.sent;\n\n                  if (!(multicallCode !== '0x')) {\n                    _context2.next = 8;\n                    break;\n                  }\n\n                  updateConfig({\n                    multicallAddresses: _defineProperty({}, chainId, multicallAddress)\n                  });\n                  return _context2.abrupt(\"return\");\n\n                case 8:\n                  signer = library.getSigner();\n\n                  if (signer) {\n                    _context2.next = 12;\n                    break;\n                  }\n\n                  setLocalMulticallState(LocalMulticallState.Error);\n                  return _context2.abrupt(\"return\");\n\n                case 12:\n                  setLocalMulticallState(LocalMulticallState.Deploying);\n\n                  deployMulticall = /*#__PURE__*/function () {\n                    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n                      var _yield$deployContract, contractAddress, _blockNumber;\n\n                      return _regeneratorRuntime().wrap(function _callee$(_context) {\n                        while (1) {\n                          switch (_context.prev = _context.next) {\n                            case 0:\n                              _context.prev = 0;\n                              _context.next = 3;\n                              return deployContract(multicallVersion === 1 ? multicallABI : multicall2ABI, signer);\n\n                            case 3:\n                              _yield$deployContract = _context.sent;\n                              contractAddress = _yield$deployContract.contractAddress;\n                              _blockNumber = _yield$deployContract.blockNumber;\n                              updateConfig({\n                                multicallAddresses: _defineProperty({}, chainId, contractAddress)\n                              });\n                              setMulticallAddress(contractAddress);\n                              setMulticallBlockNumber(_blockNumber);\n                              setLocalMulticallState(LocalMulticallState.Deployed);\n                              _context.next = 15;\n                              break;\n\n                            case 12:\n                              _context.prev = 12;\n                              _context.t0 = _context[\"catch\"](0);\n                              setLocalMulticallState(LocalMulticallState.Error);\n\n                            case 15:\n                            case \"end\":\n                              return _context.stop();\n                          }\n                        }\n                      }, _callee, null, [[0, 12]]);\n                    }));\n\n                    return function deployMulticall() {\n                      return _ref3.apply(this, arguments);\n                    };\n                  }();\n\n                  void deployMulticall();\n\n                case 15:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function checkDeployed() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      void checkDeployed();\n    }\n  }, [library, chainId]);\n  var awaitingMulticallBlock = multicallBlockNumber && blockNumber && blockNumber < multicallBlockNumber;\n\n  if (localMulticallState === LocalMulticallState.Deploying || localMulticallState === LocalMulticallState.Deployed && awaitingMulticallBlock) {\n    return _jsx(\"div\", {\n      children: \"Deploying multicall...\"\n    });\n  } else if (localMulticallState === LocalMulticallState.Error) {\n    return _jsx(\"div\", {\n      children: \"Error deploying multicall contract\"\n    });\n  } else {\n    return _jsx(_Fragment, {\n      children: children\n    });\n  }\n}","map":{"version":3,"sources":["../../../../src/providers/LocalMulticallProvider.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useEffect, useState } from 'react';\nimport { utils } from 'ethers';\nimport { getChainById } from '../helpers';\nimport { useEthers, useBlockNumber, useConfig, useUpdateConfig, useLocalStorage } from '../hooks';\nimport multicallABI from '../constants/abi/MultiCall.json';\nimport multicall2ABI from '../constants/abi/MultiCall2.json';\nimport { deployContract } from '../helpers/contract';\nvar LocalMulticallState;\n(function (LocalMulticallState) {\n    LocalMulticallState[LocalMulticallState[\"Unknown\"] = 0] = \"Unknown\";\n    LocalMulticallState[LocalMulticallState[\"NonLocal\"] = 1] = \"NonLocal\";\n    LocalMulticallState[LocalMulticallState[\"Deploying\"] = 2] = \"Deploying\";\n    LocalMulticallState[LocalMulticallState[\"Deployed\"] = 3] = \"Deployed\";\n    LocalMulticallState[LocalMulticallState[\"Error\"] = 4] = \"Error\";\n})(LocalMulticallState || (LocalMulticallState = {}));\nexport function LocalMulticallProvider({ children }) {\n    const updateConfig = useUpdateConfig();\n    const { library, chainId } = useEthers();\n    const [, setMulticallAddress, getCurrent] = useLocalStorage('local_multicall_address' + chainId);\n    const { multicallAddresses, multicallVersion } = useConfig();\n    const [localMulticallState, setLocalMulticallState] = useState(LocalMulticallState.Unknown);\n    const [multicallBlockNumber, setMulticallBlockNumber] = useState();\n    const blockNumber = useBlockNumber();\n    useEffect(() => {\n        var _a;\n        if (!library || !chainId) {\n            setLocalMulticallState(LocalMulticallState.Unknown);\n        }\n        else if (!((_a = getChainById(chainId)) === null || _a === void 0 ? void 0 : _a.isLocalChain)) {\n            setLocalMulticallState(LocalMulticallState.NonLocal);\n        }\n        else if (multicallAddresses && multicallAddresses[chainId]) {\n            setLocalMulticallState(LocalMulticallState.Deployed);\n        }\n        else if (localMulticallState !== LocalMulticallState.Deploying) {\n            const checkDeployed = async () => {\n                const multicallAddress = getCurrent();\n                if (typeof multicallAddress === 'string' && utils.isAddress(multicallAddress)) {\n                    const multicallCode = await library.getCode(multicallAddress);\n                    if (multicallCode !== '0x') {\n                        updateConfig({ multicallAddresses: { [chainId]: multicallAddress } });\n                        return;\n                    }\n                }\n                const signer = library.getSigner();\n                if (!signer) {\n                    setLocalMulticallState(LocalMulticallState.Error);\n                    return;\n                }\n                setLocalMulticallState(LocalMulticallState.Deploying);\n                const deployMulticall = async () => {\n                    try {\n                        const { contractAddress, blockNumber } = await deployContract(multicallVersion === 1 ? multicallABI : multicall2ABI, signer);\n                        updateConfig({ multicallAddresses: { [chainId]: contractAddress } });\n                        setMulticallAddress(contractAddress);\n                        setMulticallBlockNumber(blockNumber);\n                        setLocalMulticallState(LocalMulticallState.Deployed);\n                    }\n                    catch (_a) {\n                        setLocalMulticallState(LocalMulticallState.Error);\n                    }\n                };\n                void deployMulticall();\n            };\n            void checkDeployed();\n        }\n    }, [library, chainId]);\n    const awaitingMulticallBlock = multicallBlockNumber && blockNumber && blockNumber < multicallBlockNumber;\n    if (localMulticallState === LocalMulticallState.Deploying ||\n        (localMulticallState === LocalMulticallState.Deployed && awaitingMulticallBlock)) {\n        return _jsx(\"div\", { children: \"Deploying multicall...\" });\n    }\n    else if (localMulticallState === LocalMulticallState.Error) {\n        return _jsx(\"div\", { children: \"Error deploying multicall contract\" });\n    }\n    else {\n        return _jsx(_Fragment, { children: children });\n    }\n}\n//# sourceMappingURL=LocalMulticallProvider.js.map"]},"metadata":{},"sourceType":"module"}