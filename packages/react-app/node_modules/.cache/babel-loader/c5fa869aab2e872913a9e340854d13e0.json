{"ast":null,"code":"import _toConsumableArray from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _regeneratorRuntime from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _slicedToArray from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _asyncToGenerator from \"/Users/mymac/Documents/GitHub/Cryptoapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { useCallback, useState } from 'react';\nimport { useNotificationsContext, useTransactionsContext } from '../providers';\nimport { BigNumber, errors } from 'ethers';\n/**\n * @internal\n */\n\nexport function estimateTransactionGasLimit(_x, _x2, _x3) {\n  return _estimateTransactionGasLimit.apply(this, arguments);\n}\n/**\n * @internal\n */\n\nfunction _estimateTransactionGasLimit() {\n  _estimateTransactionGasLimit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(transactionRequest, signer, gasLimitBufferPercentage) {\n    var estimatedGas;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!signer || !transactionRequest)) {\n              _context2.next = 2;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", undefined);\n\n          case 2:\n            _context2.prev = 2;\n\n            if (!transactionRequest.gasLimit) {\n              _context2.next = 7;\n              break;\n            }\n\n            _context2.t0 = BigNumber.from(transactionRequest.gasLimit);\n            _context2.next = 10;\n            break;\n\n          case 7:\n            _context2.next = 9;\n            return signer.estimateGas(transactionRequest);\n\n          case 9:\n            _context2.t0 = _context2.sent;\n\n          case 10:\n            estimatedGas = _context2.t0;\n            return _context2.abrupt(\"return\", estimatedGas === null || estimatedGas === void 0 ? void 0 : estimatedGas.mul(gasLimitBufferPercentage + 100).div(100));\n\n          case 14:\n            _context2.prev = 14;\n            _context2.t1 = _context2[\"catch\"](2);\n            console.error(_context2.t1);\n            return _context2.abrupt(\"return\", undefined);\n\n          case 18:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[2, 14]]);\n  }));\n  return _estimateTransactionGasLimit.apply(this, arguments);\n}\n\nexport function estimateContractFunctionGasLimit(_x4, _x5, _x6, _x7) {\n  return _estimateContractFunctionGasLimit.apply(this, arguments);\n}\n\nfunction _estimateContractFunctionGasLimit() {\n  _estimateContractFunctionGasLimit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(contractWithSigner, functionName, args, gasLimitBufferPercentage) {\n    var _contractWithSigner$e, estimatedGas, gasLimit;\n\n    return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return (_contractWithSigner$e = contractWithSigner.estimateGas)[functionName].apply(_contractWithSigner$e, _toConsumableArray(args));\n\n          case 3:\n            estimatedGas = _context3.sent;\n            gasLimit = estimatedGas === null || estimatedGas === void 0 ? void 0 : estimatedGas.mul(gasLimitBufferPercentage + 100).div(100);\n            return _context3.abrupt(\"return\", gasLimit);\n\n          case 8:\n            _context3.prev = 8;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.error(_context3.t0);\n            return _context3.abrupt(\"return\", undefined);\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[0, 8]]);\n  }));\n  return _estimateContractFunctionGasLimit.apply(this, arguments);\n}\n\nvar isDroppedAndReplaced = function isDroppedAndReplaced(e) {\n  return (e === null || e === void 0 ? void 0 : e.code) === errors.TRANSACTION_REPLACED && (e === null || e === void 0 ? void 0 : e.replacement) && ((e === null || e === void 0 ? void 0 : e.reason) === 'repriced' || (e === null || e === void 0 ? void 0 : e.cancelled) === false);\n};\n\nexport function usePromiseTransaction(chainId, options) {\n  var _useState = useState({\n    status: 'None'\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var _useTransactionsConte = useTransactionsContext(),\n      addTransaction = _useTransactionsConte.addTransaction;\n\n  var _useNotificationsCont = useNotificationsContext(),\n      addNotification = _useNotificationsCont.addNotification;\n\n  var resetState = useCallback(function () {\n    setState({\n      status: 'None'\n    });\n  }, [setState]);\n  var promiseTransaction = useCallback( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(transactionPromise) {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, transaction, receipt, parsedErrorCode, errorCode, errorHash, errorMessage, droppedAndReplaced, status, type;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (chainId) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              transaction = undefined;\n              _context.prev = 3;\n              setState({\n                status: 'PendingSignature',\n                chainId: chainId\n              });\n              _context.next = 7;\n              return transactionPromise;\n\n            case 7:\n              transaction = _context.sent;\n              setState({\n                transaction: transaction,\n                status: 'Mining',\n                chainId: chainId\n              });\n              addTransaction({\n                transaction: Object.assign(Object.assign({}, transaction), {\n                  chainId: chainId\n                }),\n                submittedAt: Date.now(),\n                transactionName: options === null || options === void 0 ? void 0 : options.transactionName\n              });\n              _context.next = 12;\n              return transaction.wait();\n\n            case 12:\n              receipt = _context.sent;\n              setState({\n                receipt: receipt,\n                transaction: transaction,\n                status: 'Success',\n                chainId: chainId\n              });\n              return _context.abrupt(\"return\", receipt);\n\n            case 17:\n              _context.prev = 17;\n              _context.t0 = _context[\"catch\"](3);\n              parsedErrorCode = parseInt((_g = (_e = (_c = (_b = (_a = _context.t0.error) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.code) !== null && _c !== void 0 ? _c : (_d = _context.t0.error) === null || _d === void 0 ? void 0 : _d.code) !== null && _e !== void 0 ? _e : (_f = _context.t0.data) === null || _f === void 0 ? void 0 : _f.code) !== null && _g !== void 0 ? _g : _context.t0.code);\n              errorCode = isNaN(parsedErrorCode) ? undefined : parsedErrorCode;\n              errorHash = (_l = (_k = (_j = (_h = _context.t0 === null || _context.t0 === void 0 ? void 0 : _context.t0.error) === null || _h === void 0 ? void 0 : _h.data) === null || _j === void 0 ? void 0 : _j.originalError) === null || _k === void 0 ? void 0 : _k.data) !== null && _l !== void 0 ? _l : (_m = _context.t0 === null || _context.t0 === void 0 ? void 0 : _context.t0.error) === null || _m === void 0 ? void 0 : _m.data;\n              errorMessage = (_v = (_t = (_s = (_q = (_p = (_o = _context.t0.error) === null || _o === void 0 ? void 0 : _o.data) === null || _p === void 0 ? void 0 : _p.message) !== null && _q !== void 0 ? _q : (_r = _context.t0.error) === null || _r === void 0 ? void 0 : _r.message) !== null && _s !== void 0 ? _s : _context.t0.reason) !== null && _t !== void 0 ? _t : (_u = _context.t0.data) === null || _u === void 0 ? void 0 : _u.message) !== null && _v !== void 0 ? _v : _context.t0.message;\n\n              if (transaction) {\n                droppedAndReplaced = isDroppedAndReplaced(_context.t0);\n\n                if (droppedAndReplaced) {\n                  status = _context.t0.receipt.status === 0 ? 'Fail' : 'Success';\n                  type = status === 'Fail' ? 'transactionFailed' : 'transactionSucceed';\n                  addNotification({\n                    notification: {\n                      type: type,\n                      submittedAt: Date.now(),\n                      transaction: _context.t0.replacement,\n                      receipt: _context.t0.receipt,\n                      transactionName: (_w = _context.t0.replacement) === null || _w === void 0 ? void 0 : _w.transactionName,\n                      originalTransaction: transaction\n                    },\n                    chainId: chainId\n                  });\n                  setState({\n                    status: status,\n                    transaction: _context.t0.replacement,\n                    originalTransaction: transaction,\n                    receipt: _context.t0.receipt,\n                    errorMessage: errorMessage,\n                    errorCode: errorCode,\n                    errorHash: errorHash,\n                    chainId: chainId\n                  });\n                } else {\n                  setState({\n                    status: 'Fail',\n                    transaction: transaction,\n                    receipt: _context.t0.receipt,\n                    errorMessage: errorMessage,\n                    errorCode: errorCode,\n                    errorHash: errorHash,\n                    chainId: chainId\n                  });\n                }\n              } else {\n                setState({\n                  status: 'Exception',\n                  errorMessage: errorMessage,\n                  errorCode: errorCode,\n                  errorHash: errorHash,\n                  chainId: chainId\n                });\n              }\n\n              return _context.abrupt(\"return\", undefined);\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 17]]);\n    }));\n\n    return function (_x8) {\n      return _ref.apply(this, arguments);\n    };\n  }(), [chainId, setState, addTransaction, options]);\n  return {\n    promiseTransaction: promiseTransaction,\n    state: state,\n    resetState: resetState\n  };\n}","map":{"version":3,"sources":["../../../../src/hooks/usePromiseTransaction.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { useCallback, useState } from 'react';\nimport { useNotificationsContext, useTransactionsContext } from '../providers';\nimport { BigNumber, errors } from 'ethers';\n/**\n * @internal\n */\nexport async function estimateTransactionGasLimit(transactionRequest, signer, gasLimitBufferPercentage) {\n    if (!signer || !transactionRequest) {\n        return undefined;\n    }\n    try {\n        const estimatedGas = transactionRequest.gasLimit\n            ? BigNumber.from(transactionRequest.gasLimit)\n            : await signer.estimateGas(transactionRequest);\n        return estimatedGas === null || estimatedGas === void 0 ? void 0 : estimatedGas.mul(gasLimitBufferPercentage + 100).div(100);\n    }\n    catch (err) {\n        console.error(err);\n        return undefined;\n    }\n}\n/**\n * @internal\n */\nexport async function estimateContractFunctionGasLimit(contractWithSigner, functionName, args, gasLimitBufferPercentage) {\n    try {\n        const estimatedGas = await contractWithSigner.estimateGas[functionName](...args);\n        const gasLimit = estimatedGas === null || estimatedGas === void 0 ? void 0 : estimatedGas.mul(gasLimitBufferPercentage + 100).div(100);\n        return gasLimit;\n    }\n    catch (err) {\n        console.error(err);\n        return undefined;\n    }\n}\nconst isDroppedAndReplaced = (e) => (e === null || e === void 0 ? void 0 : e.code) === errors.TRANSACTION_REPLACED && (e === null || e === void 0 ? void 0 : e.replacement) && ((e === null || e === void 0 ? void 0 : e.reason) === 'repriced' || (e === null || e === void 0 ? void 0 : e.cancelled) === false);\nexport function usePromiseTransaction(chainId, options) {\n    const [state, setState] = useState({ status: 'None' });\n    const { addTransaction } = useTransactionsContext();\n    const { addNotification } = useNotificationsContext();\n    const resetState = useCallback(() => {\n        setState({ status: 'None' });\n    }, [setState]);\n    const promiseTransaction = useCallback(async (transactionPromise) => {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;\n        if (!chainId)\n            return;\n        let transaction = undefined;\n        try {\n            setState({ status: 'PendingSignature', chainId });\n            transaction = await transactionPromise;\n            setState({ transaction, status: 'Mining', chainId });\n            addTransaction({\n                transaction: Object.assign(Object.assign({}, transaction), { chainId: chainId }),\n                submittedAt: Date.now(),\n                transactionName: options === null || options === void 0 ? void 0 : options.transactionName,\n            });\n            const receipt = await transaction.wait();\n            setState({ receipt, transaction, status: 'Success', chainId });\n            return receipt;\n        }\n        catch (e) {\n            const parsedErrorCode = parseInt((_g = (_e = (_c = (_b = (_a = e.error) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.code) !== null && _c !== void 0 ? _c : (_d = e.error) === null || _d === void 0 ? void 0 : _d.code) !== null && _e !== void 0 ? _e : (_f = e.data) === null || _f === void 0 ? void 0 : _f.code) !== null && _g !== void 0 ? _g : e.code);\n            const errorCode = isNaN(parsedErrorCode) ? undefined : parsedErrorCode;\n            const errorHash = (_l = (_k = (_j = (_h = e === null || e === void 0 ? void 0 : e.error) === null || _h === void 0 ? void 0 : _h.data) === null || _j === void 0 ? void 0 : _j.originalError) === null || _k === void 0 ? void 0 : _k.data) !== null && _l !== void 0 ? _l : (_m = e === null || e === void 0 ? void 0 : e.error) === null || _m === void 0 ? void 0 : _m.data;\n            const errorMessage = (_v = (_t = (_s = (_q = (_p = (_o = e.error) === null || _o === void 0 ? void 0 : _o.data) === null || _p === void 0 ? void 0 : _p.message) !== null && _q !== void 0 ? _q : (_r = e.error) === null || _r === void 0 ? void 0 : _r.message) !== null && _s !== void 0 ? _s : e.reason) !== null && _t !== void 0 ? _t : (_u = e.data) === null || _u === void 0 ? void 0 : _u.message) !== null && _v !== void 0 ? _v : e.message;\n            if (transaction) {\n                const droppedAndReplaced = isDroppedAndReplaced(e);\n                if (droppedAndReplaced) {\n                    const status = e.receipt.status === 0 ? 'Fail' : 'Success';\n                    const type = status === 'Fail' ? 'transactionFailed' : 'transactionSucceed';\n                    addNotification({\n                        notification: {\n                            type,\n                            submittedAt: Date.now(),\n                            transaction: e.replacement,\n                            receipt: e.receipt,\n                            transactionName: (_w = e.replacement) === null || _w === void 0 ? void 0 : _w.transactionName,\n                            originalTransaction: transaction,\n                        },\n                        chainId,\n                    });\n                    setState({\n                        status,\n                        transaction: e.replacement,\n                        originalTransaction: transaction,\n                        receipt: e.receipt,\n                        errorMessage,\n                        errorCode,\n                        errorHash,\n                        chainId,\n                    });\n                }\n                else {\n                    setState({ status: 'Fail', transaction, receipt: e.receipt, errorMessage, errorCode, errorHash, chainId });\n                }\n            }\n            else {\n                setState({ status: 'Exception', errorMessage, errorCode, errorHash, chainId });\n            }\n            return undefined;\n        }\n    }, [chainId, setState, addTransaction, options]);\n    return { promiseTransaction, state, resetState };\n}\n//# sourceMappingURL=usePromiseTransaction.js.map"]},"metadata":{},"sourceType":"module"}